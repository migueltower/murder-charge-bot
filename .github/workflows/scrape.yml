name: Murder Case Scraper Parallel Batches

on:
  workflow_dispatch:

jobs:
  run-batches:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        range: [
          "0-9999", "10000-19999", "20000-29999", "30000-39999", "40000-49999",
          "50000-59999", "60000-69999", "70000-79999", "80000-89999", "90000-99999",
          "100000-109999", "110000-119999", "120000-129999", "130000-139999",
          "140000-149999", "150000-159999", "160000-170000"
        ]
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install pipenv
        run: pip install pipenv

      - name: Install dependencies
        run: pipenv install --skip-lock

      - name: Extract batch range
        id: range
        run: |
          START=$(echo "${{ matrix.range }}" | cut -d '-' -f 1)
          END=$(echo "${{ matrix.range }}" | cut -d '-' -f 2)
          echo "start=$START" >> $GITHUB_OUTPUT
          echo "end=$END" >> $GITHUB_OUTPUT

      - name: Run scraper
        env:
          START: ${{ steps.range.outputs.start }}
          END: ${{ steps.range.outputs.end }}
        run: pipenv run python scraper.py

      - name: Upload CSV file
        uses: actions/upload-artifact@v4
        with:
          name: murder-charges-${{ steps.range.outputs.start }}-${{ steps.range.outputs.end }}
          path: murder_charges.csv
